<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Quick Test - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase</title>
    <style>
        body { font-family: 'Prompt', sans-serif; padding: 20px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #e8f5e9; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        .info { background: #e3f2fd; color: #1565c0; }
        button { background: #e91e63; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</h1>
    
    <button onclick="testAll()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    <div id="results"></div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="shared/config/supabase.js"></script>
    <script>
        async function testAll() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>';
            
            let html = '';
            
            try {
                // 1. Test connection
                html += '<h3>1. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>';
                if (!window.supabaseClient) {
                    html += '<div class="error">‚ùå Supabase client ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>';
                    results.innerHTML = html;
                    return;
                }
                html += '<div class="success">‚úÖ Supabase client ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
                
                // 2. Test tables
                html += '<h3>2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á</h3>';
                const tables = ['menu_categories', 'menu_items', 'customers', 'orders', 'order_items', 'admin_users'];
                
                for (const table of tables) {
                    try {
                        const { count, error } = await window.supabaseClient
                            .from(table)
                            .select('*', { count: 'exact', head: true });
                        
                        if (error) {
                            html += `<div class="error">‚ùå ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ${table}: ${error.message}</div>`;
                        } else {
                            html += `<div class="success">‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ${table}: ${count || 0} ‡πÅ‡∏ñ‡∏ß</div>`;
                        }
                    } catch (e) {
                        html += `<div class="error">‚ùå ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ${table}: ${e.message}</div>`;
                    }
                }
                
                // 3. Test orders specifically
                html += '<h3>3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>';
                const { data: orders, error: ordersError } = await window.supabaseClient
                    .from('orders')
                    .select(`
                        *,
                        customers (name, phone, dorm, room),
                        order_items (quantity, price, menu_items (name))
                    `)
                    .order('created_at', { ascending: false });
                
                if (ordersError) {
                    html += `<div class="error">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${ordersError.message}</div>`;
                } else if (!orders || orders.length === 0) {
                    html += '<div class="info">‚ÑπÔ∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
                    html += '<div class="info">üìù ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô SQL scripts ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</div>';
                } else {
                    html += `<div class="success">‚úÖ ‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${orders.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;
                    html += `<div class="info">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${orders[0].order_number || orders[0].id}</div>`;
                }
                
                // 4. Test menu items  
                html += '<h3>4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏ô‡∏π</h3>';
                const { data: menuItems, error: menuError } = await window.supabaseClient
                    .from('menu_items')
                    .select('count');
                
                if (menuError) {
                    html += `<div class="error">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π: ${menuError.message}</div>`;
                    html += '<div class="error">üö® ‡∏ï‡∏≤‡∏£‡∏≤‡∏á menu_items ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô SQL scripts</div>';
                } else {
                    html += `<div class="success">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>`;
                }
                
            } catch (e) {
                html += `<div class="error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</div>`;
            }
            
            results.innerHTML = html;
        }
        
        // Auto run on load
        window.addEventListener('load', testAll);
    </script>
</body>
</html>