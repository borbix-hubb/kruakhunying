-- à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡
INSERT INTO menu_categories (id, name, name_en, icon, sort_order, is_active) 
VALUES ('00000000-0000-0000-0000-000000000001', 'ðŸ¥¤ à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡', 'Beverages', 'ðŸ¥¤', 100, true)
ON CONFLICT (id) DO NOTHING;

-- à¸¢à¹‰à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸¡à¸™à¸¹à¸ˆà¸²à¸à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹€à¸à¹ˆà¸²à¹„à¸›à¸¢à¸±à¸‡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ
UPDATE menu_items 
SET category_id = '00000000-0000-0000-0000-000000000001'
WHERE category_id IN (
  'fec26326-3d01-420f-a11f-b7e4d52e2a4a', -- à¸à¸²à¹à¸Ÿ
  '15930484-23ae-45a5-8aff-1434b374941c', -- à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¹à¸Ÿ
  '178b44bf-425d-4301-b5f8-4f1d2a741b85', -- à¸Šà¸²
  '7842292a-8caf-45dd-8b41-4ec19ec75742', -- à¹‚à¸‹à¸”à¸²
  '863bd598-1d60-464e-ad22-5d3155609d45'  -- à¸ªà¸¡à¸¹à¸—à¸•à¸µà¹‰
);

-- à¸¢à¹‰à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸¡à¸™à¸¹à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µ category_id à¹„à¸›à¸¢à¸±à¸‡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡
UPDATE menu_items 
SET category_id = '00000000-0000-0000-0000-000000000001'
WHERE category_id IS NULL;

-- à¸¥à¸šà¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹€à¸à¹ˆà¸²à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§
DELETE FROM menu_categories 
WHERE id IN (
  'fec26326-3d01-420f-a11f-b7e4d52e2a4a', -- à¸à¸²à¹à¸Ÿ
  '15930484-23ae-45a5-8aff-1434b374941c', -- à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¹à¸Ÿ
  '178b44bf-425d-4301-b5f8-4f1d2a741b85', -- à¸Šà¸²
  '7842292a-8caf-45dd-8b41-4ec19ec75742', -- à¹‚à¸‹à¸”à¸²
  '863bd598-1d60-464e-ad22-5d3155609d45'  -- à¸ªà¸¡à¸¹à¸—à¸•à¸µà¹‰
);

-- à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸¡à¸™à¸¹à¸—à¸µà¹ˆà¸‹à¹‰à¸³à¸à¸±à¸™ à¹‚à¸”à¸¢à¹€à¸à¹‡à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸¡à¸µ ID à¹€à¸à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¸¸à¸”
WITH duplicates AS (
  SELECT 
    name,
    MIN(created_at) as first_created,
    array_agg(id ORDER BY created_at) as all_ids
  FROM menu_items
  WHERE category_id = '00000000-0000-0000-0000-000000000001'
  GROUP BY name
  HAVING COUNT(*) > 1
)
DELETE FROM menu_items 
WHERE id IN (
  SELECT unnest(all_ids[2:]) 
  FROM duplicates
);